<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Eventos del Ministerio - Ministerio AI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Lora:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./styles.css">
    <style>
      .calendar-container {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
      }
      .event-list {
        display: grid;
        gap: 1.5rem;
        margin-top: 2rem;
      }
      .event-card {
        background: white;
        border-left: 4px solid #667eea;
        padding: 1.5rem;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 1.5rem;
        transition: transform 0.2s;
      }
      .event-card:hover {
        transform: translateX(8px);
      }
      .event-date {
        text-align: center;
        padding: 1rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 8px;
        min-width: 100px;
      }
      .event-date .day {
        font-size: 2rem;
        font-weight: 700;
        line-height: 1;
      }
      .event-date .month {
        font-size: 0.9rem;
        text-transform: uppercase;
        margin-top: 0.25rem;
      }
      .event-date .time {
        font-size: 0.85rem;
        margin-top: 0.5rem;
        opacity: 0.9;
      }
      .event-details h3 {
        color: #667eea;
        margin-bottom: 0.5rem;
      }
      .event-type-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.85rem;
        font-weight: 600;
        margin-right: 0.5rem;
      }
      .event-type-service { background: #e3f2fd; color: #1976d2; }
      .event-type-study { background: #f3e5f5; color: #7b1fa2; }
      .event-type-prayer { background: #fff3e0; color: #ef6c00; }
      .event-type-special { background: #ffebee; color: #c62828; }
      .regular-services {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        border-radius: 12px;
        margin-bottom: 2rem;
      }
      .regular-services h2 {
        margin-bottom: 1.5rem;
      }
      .service-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
      }
      .service-item {
        background: rgba(255,255,255,0.1);
        padding: 1.5rem;
        border-radius: 8px;
        backdrop-filter: blur(10px);
      }
      .service-item h3 {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
      }
      .service-item p {
        font-size: 0.95rem;
        opacity: 0.9;
      }
      .nav-links {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        justify-content: center;
      }
      .nav-links a {
        padding: 0.5rem 1rem;
        background: #f0f0f0;
        border-radius: 8px;
        text-decoration: none;
        color: #333;
        font-weight: 500;
      }
      .nav-links a:hover {
        background: #667eea;
        color: white;
      }
      .empty-state {
        text-align: center;
        padding: 3rem;
        color: #999;
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="container">
        <div class="header-content">
          <div class="logo-section">
            <div class="heart-icon">üìÖ</div>
            <div class="title-section">
              <h1 class="main-title">Eventos del Ministerio</h1>
              <p class="subtitle">√önete a nuestras actividades</p>
            </div>
          </div>
          <div class="header-actions">
            <a href="/" class="home-btn">
              <span>Inicio</span>
            </a>
          </div>
        </div>
      </div>
    </header>

    <div class="main-container">
      <div class="container">
        <div class="nav-links">
          <a href="sermons.html">Sermones</a>
          <a href="devotionals.html">Devocionales</a>
          <a href="bible-study.html">Estudios</a>
          <a href="prayers.html">Oraciones</a>
          <a href="events.html">Eventos</a>
        </div>

        <!-- Sistema de autenticaci√≥n administrativa -->
        <div id="adminLogin" class="admin-login" style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 2rem; max-width: 400px; margin-left: auto; margin-right: auto; text-align: center;">
          <h3 style="color: #667eea; margin-bottom: 1rem;">üîê Acceso Administrativo</h3>
          <p style="color: #666; margin-bottom: 1rem;">Solo personal autorizado puede agregar eventos</p>
          <input type="password" id="adminPassword" placeholder="Contrase√±a administrativa" style="width: 100%; padding: 0.75rem; margin: 0.5rem 0; border: 1px solid #ddd; border-radius: 8px; font-family: 'Inter', sans-serif;">
          <button onclick="authenticateAdmin()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1rem 2rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 1rem; width: 100%;">Ingresar</button>
          <p id="loginError" style="color: #dc3545; margin-top: 0.5rem; display: none;">Contrase√±a incorrecta</p>
        </div>

        <!-- Secci√≥n de agregar eventos (visible solo despu√©s del login) -->
        <div id="addEventSection" class="add-event-section" style="display: none; background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 2rem; text-align: center;">
          <h3 style="color: #28a745; margin-bottom: 1rem;">‚úÖ Acceso Autorizado</h3>
          <button class="add-event-btn" onclick="openEventModal()" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 1rem 2rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin: 0.5rem;">‚ûï Agregar Nuevo Evento</button>
          <button onclick="logoutAdmin()" style="background: #dc3545; color: white; padding: 1rem 2rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin: 0.5rem;">Cerrar Sesi√≥n</button>
        </div>

        <!-- Modal para agregar eventos -->
        <div id="eventModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
          <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 500px; width: 90%; max-height: 80%; overflow-y: auto;">
            <h3 style="text-align: center; margin-bottom: 1rem;">Agregar Nuevo Evento</h3>
            <form id="addEventForm">
              <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">T√≠tulo del Evento:</label>
                <input type="text" id="eventTitle" required style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 8px;">
              </div>
              <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Fecha y Hora:</label>
                <input type="datetime-local" id="eventDateTime" required style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 8px;">
              </div>
              <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Descripci√≥n:</label>
                <textarea id="eventDescription" rows="3" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 8px; resize: vertical;"></textarea>
              </div>
              <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Ubicaci√≥n:</label>
                <input type="text" id="eventLocation" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 8px;">
              </div>
              <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1.5rem;">
                <button type="button" onclick="closeEventModal()" style="background: #6c757d; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 8px; cursor: pointer;">Cancelar</button>
                <button type="submit" style="background: #28a745; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 8px; cursor: pointer;">Agregar Evento</button>
              </div>
            </form>
          </div>
        </div>

        <div class="regular-services">
          <h2>Servicios Regulares</h2>
          <div class="service-grid">
            <div class="service-item">
              <h3>Domingos</h3>
              <p>Servicio Principal</p>
              <p><strong>11:00 AM</strong></p>
            </div>
            <div class="service-item">
              <h3>Mi√©rcoles</h3>
              <p>Estudio B√≠blico</p>
              <p><strong>7:00 PM</strong></p>
            </div>
            <div class="service-item">
              <h3>Viernes</h3>
              <p>Servicio Evangel√≠stico</p>
              <p><strong>7:00 PM</strong></p>
            </div>
          </div>
          <p style="text-align: center; margin-top: 1.5rem; font-size: 0.95rem;">
            üìç 2702 New Hampshire St, Lake Station, IN 46405<br>
            üìû (219) 246-5775
          </p>
        </div>

        <div class="calendar-container">
          <h2>Pr√≥ximos Eventos Especiales</h2>
          <div id="eventList" class="event-list"></div>
        </div>
      </div>
    </div>

    <script type="module">
      import { getMinistryEvents } from './supabase-client.js';

      const eventList = document.getElementById('eventList');

      // Sistema de autenticaci√≥n
      const ADMIN_PASSWORD = 'ministerial2025';

      function checkAuth() {
        const isAuthenticated = localStorage.getItem('ministry_admin_auth') === 'true';
        if (isAuthenticated) {
          document.getElementById('adminLogin').style.display = 'none';
          document.getElementById('addEventSection').style.display = 'block';
        }
      }

      function authenticateAdmin() {
        const password = document.getElementById('adminPassword').value;
        const loginError = document.getElementById('loginError');
        
        if (password === ADMIN_PASSWORD) {
          localStorage.setItem('ministry_admin_auth', 'true');
          document.getElementById('adminLogin').style.display = 'none';
          document.getElementById('addEventSection').style.display = 'block';
          document.getElementById('adminPassword').value = '';
          loginError.style.display = 'none';
        } else {
          loginError.style.display = 'block';
          loginError.textContent = 'Contrase√±a incorrecta';
        }
      }

      function logoutAdmin() {
        localStorage.removeItem('ministry_admin_auth');
        document.getElementById('adminLogin').style.display = 'block';
        document.getElementById('addEventSection').style.display = 'none';
      }

      function openEventModal() {
        document.getElementById('eventModal').style.display = 'flex';
      }

      function closeEventModal() {
        document.getElementById('eventModal').style.display = 'none';
        document.getElementById('addEventForm').reset();
      }

      // Cargar eventos
      async function loadEvents() {
        try {
          const events = await getMinistryEvents();

          if (!events || events.length === 0) {
            eventList.innerHTML = `
              <div class="empty-state">
                <p>No hay eventos especiales programados en este momento.</p>
                <p>√önete a nuestros servicios regulares cada semana.</p>
              </div>
            `;
            return;
          }

          eventList.innerHTML = events.map(event => {
            const eventDate = new Date(event.event_date);
            const day = eventDate.getDate();
            const month = eventDate.toLocaleDateString('es-ES', { month: 'short' });
            const time = eventDate.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
            
            let typeClass = 'event-type-service';
            let typeName = 'Servicio';
            
            if (event.event_type === 'study') {
              typeClass = 'event-type-study';
              typeName = 'Estudio';
            } else if (event.event_type === 'prayer') {
              typeClass = 'event-type-prayer';
              typeName = 'Oraci√≥n';
            } else if (event.event_type === 'special') {
              typeClass = 'event-type-special';
              typeName = 'Evento Especial';
            }

            return `
              <div class="event-card">
                <div class="event-date">
                  <div class="day">${day}</div>
                  <div class="month">${month}</div>
                  <div class="time">${time}</div>
                </div>
                <div class="event-details">
                  <div>
                    <span class="event-type-badge ${typeClass}">${typeName}</span>
                  </div>
                  <h3>${event.title}</h3>
                  <p>${event.description || 'Te esperamos en este evento especial'}</p>
                  ${event.location ? `<p style="color: #667eea; margin-top: 0.5rem;">üìç ${event.location}</p>` : ''}
                </div>
              </div>
            `;
          }).join('');
        } catch (error) {
          console.error('Error cargando eventos:', error);
          eventList.innerHTML = `
            <div class="empty-state">
              <p>No se pudieron cargar los eventos en este momento.</p>
            </div>
          `;
        }
      }

      // Event listeners
      document.getElementById('adminPassword')?.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          authenticateAdmin();
        }
      });

      document.getElementById('addEventForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const title = document.getElementById('eventTitle').value;
        const dateTime = document.getElementById('eventDateTime').value;
        const description = document.getElementById('eventDescription').value;
        const location = document.getElementById('eventLocation').value;
        
        if (!title || !dateTime) {
          alert('Por favor completa el t√≠tulo y la fecha del evento');
          return;
        }
        
        // Crear evento
        const newEvent = {
          title: title,
          event_date: dateTime,
          description: description,
          location: location,
          event_type: 'event'
        };
        
        try {
          const { addMinistryEvent } = await import('./supabase-client.js');
          await addMinistryEvent(newEvent);
          
          alert('¬°Evento agregado exitosamente!');
          closeEventModal();
          loadEvents(); // Recargar la lista
        } catch (error) {
          console.error('Error agregando evento:', error);
          alert('Error al agregar el evento. Intenta nuevamente.');
        }
      });

      // Cargar al inicio
      loadEvents();
      checkAuth(); // Verificar autenticaci√≥n al cargar
    </script>
  </body>
</html>
